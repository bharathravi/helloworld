<!DOCTYPE html>
{% autoescape true %}
<html>
   <head>
     <link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />

     <!-- Grab the JQuery API from the Google servers -->
     <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  
    <script type="text/javascript" charset="utf-8">
    function ResponseToDiv(response) {
      if (response == 1) { 
        return "divYes";
      } else if (response == 0) {
        return "divMaybe";
      } else if (response == -1) {
        return "divNo";
      }
    }
    function DrawResponse(response) {
      var divName = ResponseToDiv(response);
  
      $(".response").each(function( i ) {
        id = $(this).attr('id');
        if (id == divName) {
          $(this).addClass("selected");
        } else {
          $(this).removeClass("selected");
        }
      }); 
    }
  
    function SetResponse(response) {
      var dataString = "rsvp=" + response;
      var divName = '#' + ResponseToDiv(response);
      old = $(divName).text();
      $(divName).text("Saving...");
      
      console.log(dataString);
      $.ajax({
        type: "POST",
        data: dataString,
        url: "/rsvp",
        success: function(data) {
          console.log("RET " + data.retval);
          $(divName).text(old);
          DrawResponse(response);
          $('#rsvpResult').insertBefore('<div>Success!</div>').delay(3000).fadeOut();
        }
      });
    }
  
    $(document).ready(function(){
      console.log("READY");
      $("#divYes").click(function(){
        SetResponse(1);
      });
  
      $("#divMaybe").click(function(){
        SetResponse(0);
      });
  
      $("#divNo").click(function(){
        SetResponse(-1);
      });
  
      DrawResponse(parseInt({{ guest.rsvp }}));
    });
    </script>
  </head>
  
  <body>
    {% if guest %}
       <p>
         Hi {{ guest.first_name }} {{guest.last_name }}! <br>

         <div id="divYes" class="response"> Yes </div>
         <div id="divMaybe" class="response"> Maybe </div>
         <div id="divNo" class="response"> No </div>

	<br><br><br>
         <div id="rsvpResult"></div>
         If this is not you, click here.
       </p>
    {% else %}
      <p>Not found :( Sign in as a different user?</p>
    {% endif %}

    <a href="{{ logout_url }}"> Logout </a>

  </body>
<html>
{% endautoescape %}
