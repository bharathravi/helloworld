<!DOCTYPE html>
{% autoescape true %}
<html class="no-js">
  <head>
    <meta name=viewport content='width=700'>
    <link type="text/css" rel="stylesheet" href="/stylesheets/parallax.css" />
    <link type="text/css" rel="stylesheet" href="/stylesheets/snowflakes.css" />

    <!-- Grab the JQuery API from the Google servers -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript" charset="utf-8"></script>

    <!-- Scripts for parallax  -->
    <script type="text/javascript" src="scripts/jquery.parallax-1.1.3.js"></script>
    <script type="text/javascript" src="scripts/jquery.localscroll-1.2.7-min.js"></script>
    <script type="text/javascript" src="scripts/jquery.scrollTo-1.4.2-min.js"></script>
    <script type="text/javascript" src="scripts/imagesloaded.js"></script>
    <script type="text/javascript" src="scripts/skrollr.js"></script>
    <script type="text/javascript" src="scripts/snowflakes.js"></script>
    <script type="text/javascript" charset="utf-8">

    function ResponseToDiv(response) {
      if (response == 1) { 
        return "divYes";
      } else if (response == 0) {
        return "divMaybe";
      } else if (response == -1) {
        return "divNo";
      }
    }

    function DrawResponse(response) {
      var divName = ResponseToDiv(response);
  
      $(".response").each(function( i ) {
        id = $(this).attr('id');
        if (id == divName) {
          $(this).addClass("selected");
        } else {
          $(this).removeClass("selected");
        }
      }); 
    }
  
    var inProgress = false;
    function SetResponse(response) {
      if (inProgress)
        return;

      inProgress = true;
      var dataString = "rsvp=" + response;
      var divName = '#' + ResponseToDiv(response);
      old = $(divName).text();
      $(divName).text("Saving...");
 
      console.log(dataString);
      $.ajax({
        type: "POST",
        data: dataString,
        url: "/rsvp",
        success: function(data) {
          console.log("RET " + data.retval);
          $(divName).text(old);
          DrawResponse(response);
          inProgress = false;
        }
      });
    }
  
    $(document).ready(function(){
      // Preload everything
       // Setup variables
        $window = $(window);
        $stat = $('.static');
        $storyelement = $('.storyelement');
        $body = $('body');

        //FadeIn all sections   
        $body.imagesLoaded( function() {
           setTimeout(function() {
             // Resize sections
             adjustWindow();

             // Fade in sections
             $body.removeClass('loading');
           }, 800);
        });


        function adjustWindow(){
                // Init Skrollr
                var s = skrollr.init();

                // Get window size
                winH = $window.height();

               // Keep minimum height 550
               if(winH <= 550) {
                        winH = 550;
                }

                // Resize our slides
               $("#story").removeClass("loadingStory");
	       $("#story").addClass("loaded");

              // Refresh Skrollr after resizing our sections
              s.refresh($('#story'));
        }



      console.log("READY");
      $("#divYes").click(function(){
        SetResponse(1);
      });
  
      $("#divMaybe").click(function(){
        SetResponse(0);
      });
  
      $("#divNo").click(function(){
        SetResponse(-1);
      });
  
      DrawResponse(parseInt({{ guest.rsvp }}));

      // Initiate parallaz stuff
      $('#nav').localScroll(800);

 

      var snowflakes = new Snowflakes('third','snowflakesContainer');
      snowflakes.create(200);
  
      //.parallax(xPosition, speedFactor, outerHeight) options:
      //xPosition - Horizontal position of the element
      //inertia - speed to move relative to vertical scroll. Example: 0.1 is one tenth the speed of scrolling,
      //2 is twice the speed of scrolling
      //outerHeight (true/false) - Whether or not jQuery should use it's outerHeight option to determine when a section is in the viewport
  
//      $('#first').parallax("50%", 0.2);
//      $('#second').parallax("50%", 0.4);
//      $('#third').parallax("50%", 0.3);
//      $('#fourth').parallax("50%", 0.23);
//      $('#fifth').parallax("50%", 0.24);
//      $('#sixth').parallax("50%", 0.25);
    });
    </script>
  </head>
  
  <body class="loading">
    {% if guest %}
	<div id="preload">
	   <img src="/images/beachbg.jpg" width="1" height="1" alt="" />
	   <img src="/images/snowbg.jpg" width="1" height="1" alt="" />
	   <img src="/images/mountainbg.jpg" width="1" height="1" alt="" />
	   <img src="/images/marsbg.jpg" width="1" height="1" alt="" />
	   <img src="/images/weddingbg.jpg" width="1" height="1" alt="" />
	   <img src="/images/us.png" width="1" height="1" alt="" />
	   <img src="/images/beachdress.png" width="1" height="1" alt="" />
	   <img src="/images/winterdress.png" width="1" height="1" alt="" />
	   <img src="/images/mountaindress.png" width="1" height="1" alt="" />
	   <img src="/images/astrodress.png" width="1" height="1" alt="" />
	   <img src="/images/weddingdress.png" width="1" height="1" alt="" />
	   <img src="/images/weddingfamilydress.png" width="1" height="1" alt="" />
	   <img src="/images/IntroSentence1.png" width="1" height="1" alt="" />
	   <img src="/images/IntroSentence2.png" width="1" height="1" alt="" />
	   <img src="/images/weddingfamilydress.png" width="1" height="1" alt="" />
	</div>
           
       <div id="intro">
         Hi {{ guest.first_name }} {{guest.last_name }}! 
            
         <a href="{{ logout_url }}"> Sign Out here</a>.
         </div>
       </div>

        <div id="story" class="loadingStory">
          <div id="defaultdress" class="static">

            <div id ="beachdress" class="static" 
                data-center="opacity: 10"
                data-center-top="opacity: 0"
                data--300-bottom="opacity: 0;"
                data-anchor-target="#second">
            </div><!-- beachdress -->

            <div id ="winterdress" class="static" 
                data-center="opacity: 4"
                data-center-top="opacity: 0"
                data--300-bottom="opacity: 0;"
                data-anchor-target="#third">
            </div><!-- winterdress -->

            <div id ="mountaindress" class="static" 
                data-center="opacity: 4"
                data-center-top="opacity: 0"
                data--300-bottom="opacity: 0;"
                data-anchor-target="#fourth">
            </div><!-- minedress -->

            <div id ="astrodress" class="static" 
                data-center="opacity: 4"
                data-center-top="opacity: 0"
                data--300-bottom="opacity: 0;"
                data-anchor-target="#fifth">
            </div><!-- astrodress -->

            <div id ="weddingdress" class="static" 
                data-center="opacity: 3"
                data-center-top="opacity: 0;"
                data-anchor-target="#sixth">
            </div><!-- weddingdress -->

            <div id ="weddingfamilydress" class="static" 
                data-center="opacity: 3"
                data-center-top="opacity: 0;"
                data-anchor-target="#seventh">
            </div><!-- weddingfamilydress -->
			
			<div id ="finalinvite" class="static" 
                data-center="opacity: 3"
                data-center-top="opacity: 0;"
                data-anchor-target="#eighth">
				<div id="responseOuter" class="static"
                data-center="opacity: 3"
                data-center-top="opacity: 0;"
                data-anchor-target="#seventh">
                <div id="divYes" class="response"> Yes </div>
                <div id="divMaybe" class="response"> Maybe </div>
                <div id="divNo" class="response"> No </div>
            </div><!-- responseOuter -->
         
            </div><!-- finalinvite -->
          </div><!-- static -->

		  <div id="first" class="storyelement"></div>
          <div id="firstandahalf" class="storyelement"></div>
          <div id="second" class="storyelement"></div>
          <div id="third" class="storyelement">
		  <div id="snowflakesContainer" ></div>            
          </div> <!--#Third-->
          <div id="fourth" class="storyelement"></div>
          <div id="fifth" class="storyelement"></div>
          <div id="sixth" class="storyelement"></div>
          <div id="seventh" class="storyelement"></div>
          <div id="eighth" class="storyelement"></div>
        </div> <!--.story-->
		
		
		
    {% else %}
      <p>Not found :( Sign in as a different user? <a href="{{ logout_url }}"> Logout </a> </p>
    {% endif %}
  </body>
<html>
{% endautoescape %}
